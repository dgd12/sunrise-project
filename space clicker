#include<stdio.h>
#include<stdlib.h>
#include<conio.h>
#include<Windows.h>
#include<time.h>

int count=0;
int l;
int n;
int A=1;
int p;


int midsave(int count)
{
	int num=count;
	int*pnum=&num;
	*pnum=count;
}

/*int Lotto(void)
{
	int p=0;
	srand((unsigned int) time(NULL));
	p = rand() % 10001;
	save_4(p);
}*/
int save(int count)
{
	FILE * fp=fopen("money.txt", "wt");
	if(fp==NULL) {
		puts("저장하기 실패!");
		return -1;
	}
	fprintf(fp, "%d", count);
	count-=1;
	fclose(fp);

	system("cls");
	puts("저장 완료!");
	printf("계속하려면 스페이스바를 눌러주세요");
}
int save_2(int n,int l)
{
	FILE * fp2=fopen("store.txt", "wt");
	if(fp2==NULL) {
		puts("저장하기 실패!");
		return -1;
	}
	fprintf(fp2, "%d, %d", n, l);
	fclose(fp2);
}

int save_3(int A)
{
	FILE * fp3 = fopen("x.txt", "wt");
	if(fp3==NULL) {
		puts("저장하기 실패!");
		return -1;
	}
	fprintf(fp3, "%d", A);
	fclose(fp3);
}
int save_4(int p)
{
	FILE * fp4 = fopen("lotto.txt", "wt");
	if(fp4==NULL) {
		puts("저장하기 실패!");
		return -1;
	}
	fprintf(fp4, "%d", p);
	fclose(fp4);
}
int read_4()
{
	FILE * fp4 = fopen("lotto.txt", "r");
	if(fp4==NULL) {
		puts("불러오기 실패!");
		return -1;
	}
	fscanf(fp4, "%d", &p);
	fclose(fp4);
}

int read_3()
{
	FILE * fp3 = fopen("x.txt", "r");
	if(fp3==NULL) {
		puts("불러오기 실패!");
		return -1;
	}
	fscanf(fp3, "%d", &A);
	fclose(fp3);
}

int read_2()
{
	FILE * fp2=fopen("store.txt", "r");
	if(fp2==NULL) {
		puts("불러오기 실패!");
		return -1;
	}
	fscanf(fp2, "%d, %d", &n, &l);
	fclose(fp2);
}

int read()
{
	FILE * fp=fopen("money.txt", "r");
	if(fp==NULL) {
		puts("불러오기 실패!");
		return -1;
	}
	else
	{
		fscanf(fp,"%d", &count);
}
	fclose(fp);
}


int Choose(int choose)
{
	char a;
	int b=1;
	char c;
	
	switch(choose)
	{
	case 1:
		read_3();
		system("cls");
		printf("                   스페이스바를 클릭을하여 돈을 벌어주세요 \n");
		
	   
	    for(a=0;a<=2000000000; a++)
		{
			a = getch();
			{
			if(a==32)
				count = count+A;
				system("cls");
			}
			
			printf("\n\n\n\n\n\n\n\n\n\n\n\n\n %35d 원", count);
			printf("\n\n\n\n\n\n\n\n\n\n\n\n\n\n %50d. 상점", b);
			printf("\n %50d. 저장", b+1);
			printf("\n\n %50d. 끝내기", b+2);
			
		
			if(a==49)
			{
				save(count);
				Store();
			}
				
			if(a==50)
			{
				save(count);
				save_2(n,l);
				save_3(A);
				save_4;
			}
	

			if(a==51)
			{
				return 0;
			}
		}
	case 2:
		system("cls");
		printf("\n          스페이스바를 눌러서 돈을 벌어 상점에서 아이템을 구입해 돈을 모아보세요.\n\n                    돌아가려면 r키를 눌러주세요.");
		c= getch();
		if(c==114)
			Choose(c);
	case 3:
		read();
		read_2();
		read_3();
		Choose(1);

	case 4:
		return 0;
	default:
		system("cls");
		printf("\n");
		printf("\n\n\n\n\n\n\n\n\n                         │     Space    │ Clicker\n");
	    printf("\n\n\n                                  1. 시작하기\n");
	    printf("                                  2. 설명보기\n");
		printf("                                  3. 불러오기\n");
		printf("                                  4. 끝내기\n");
		scanf("%d", &choose);
		Choose(choose);
		
	}
}

int Store(void)
{
	int m;
	read();
	read_2();
	read_3();

	system("cls");
	printf("상점에 오신걸 환영합니다. \n보유 현금 : %d원 ", count);
	printf("\n\n 1. x%d \n 가격 : %d원\n", n, l);
	printf("\n 2. 초급복권 \n 가격 : %d원 \n", 5000);
	printf("\n\n\n\n\n 0.되돌아가기 \n\n\n ->");
	m=getch();
	if(m==49)
	{
		if(count>=l)
		{
			printf("구입완료");
			count = count-l;
			save(count);
			save_2(n*2,l*2);
			save_3(A*2);
			Store();
		}
		else
			
			Store();
	}/*
	if(m==50)
	{
		Lotto();
		read_4();
		if(count>=5000)
		{
			printf("구입완료");
			count = count-5000+p;
			save(count);
			Store();
		}
		else
			Store();
	}*/
	if(m==48)
	{
		save(count);
		Choose(1);
		read();
	}
		

	

			
}
void zr(void)
{
	save_2(2,100);
	save_3(1);
}
	

int main(void)
{
	int choose;
	printf("\n\n\n\n\n\n\n\n\n                         │     Space    │ Clicker\n");
	printf("\n\n\n                                  1. 시작하기\n");
	printf("                                  2. 설명보기\n");
	printf("                                  3. 불러오기\n");
	printf("                                  4. 끝내기\n");

	scanf("%d", &choose);
	if(choose==1)
		zr();
	Choose(choose);
	
	
	return 0;
}
